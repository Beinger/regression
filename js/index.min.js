let app=new Vue({el:"#root",data:{show_v:!0,index:0,new_item:"",show:!1,add:!1,vol_select:[50,100,250,1,25,10],names:[{st:[],judge:!1,v:50,start:1,end:1,id:1,name:"氨氮",limit:.05,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.005],[1,.01],[3,.02],[5,.029],[7,.039],[10,.055]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:2,st:[],judge:!1,v:250,start:1,end:1,name:"氰化物",a:0,b:1,r:1,c:0,formula:"",x:[],y:[],limit:.002,standard_series:[],items:[[0,.004],[.1,.016],[.3,.035],[.5,.053],[.7,.073],[.9,.092]],results:[],new_results:{id:1,v:250,a:"",m:"",result:""}},{id:3,st:[],judge:!1,v:50,start:1,end:1,name:"锰",limit:.05,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.002],[10,.008],[30,.024],[50,.038],[70,1.053],[90,.068]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:4,st:[],judge:!1,v:25,start:1,end:1,name:"氟化物",limit:.2,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.371],[2.5,.432],[5,.473],[10,.559],[20,.724],[40,1.053]],results:[],new_results:{id:1,v:25,a:"",m:"",result:""}},{id:5,st:[],judge:!1,v:1,start:1,end:1,name:"硝酸盐氮",limit:.5,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.007],[.5,.03],[1,.047],[3,.13],[5,.197],[7,.278],[10,.405]],results:[],new_results:{id:1,v:1,a:"",m:"",result:""}},{id:6,st:[],judge:!1,v:100,start:1,end:1,name:"铝",limit:.008,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.004],[.5,.066],[1,.143],[2,.3],[3,.446],[4,.585],[5,.725]],results:[],new_results:{id:1,v:100,a:"",m:"",result:""}},{id:7,st:[],judge:!1,v:50,start:1,end:1,name:"挥发酚",limit:.002,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.006],[.5,.016],[1,.028],[3,.07],[5,.121],[7,.162],[10,.234]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:8,st:[],judge:!1,v:50,start:1,end:1,name:"汞",limit:.001,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.406],[.5,.423],[1,.441],[2,.474],[4,.531],[6,.598],[8,.66]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:9,st:[],judge:!1,v:50,start:1,end:1,name:"阴离子合成洗涤剂",limit:.025,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.019],[5,.041],[10,.075],[20,.128],[30,.185],[40,.233],[50,.29]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:10,st:[],judge:!1,v:50,start:1,end:1,name:"硒",limit:.001,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.024],[1,.035],[2,.047],[4,.068],[6,.088],[8,.11]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:11,st:[],judge:!1,v:100,start:1,end:1,name:"镉",limit:.01,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.207],[.25,.216],[.5,.224],[1,.242],[2,.273],[4,.336]],results:[],new_results:{id:1,v:100,a:"",m:"",result:""}},{id:12,st:[],judge:!1,v:50,start:1,end:1,name:"铅",limit:.01,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.434],[.5,.451],[1,.471],[2,.502],[4,.567],[6,.63]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:13,st:[],judge:!1,v:50,start:1,end:1,name:"六价铬",limit:.004,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.002],[.5,.012],[1,.019],[2,.034],[4,.069],[6,.103]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:14,st:[],judge:!1,v:50,start:1,end:1,name:"铜",limit:.02,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.038],[2,.08],[4,.121],[6,.16],[8,.201],[10,.238]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:15,st:[],judge:!1,v:50,start:1,end:1,name:"锰",limit:.05,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.002],[10,.008],[30,.024],[50,.038],[70,.053],[90,.068]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:16,st:[],judge:!1,v:50,start:1,end:1,name:"铁",limit:.05,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.095],[5,.122],[10,.149],[20,.196],[30,.246],[40,.29]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:17,st:[],judge:!1,v:50,start:1,end:1,name:"锌",limit:.05,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.748],[.5,.811],[1,.89],[2,1.036],[4,1.32],[6,1.602]],results:[],new_results:{id:1,v:50,a:"",m:"",result:""}},{id:18,st:[],judge:!1,v:50,start:1,end:1,name:"硫酸盐",limit:5,a:0,b:1,r:1,c:0,formula:"",x:[],y:[],standard_series:[],items:[[0,.029],[3,.355],[5,.574],[7,.784],[10,1.137]],results:[],new_results:{id:1,v:25,a:"",m:"",result:""}}],selected:""},watch:{selected:function(){this.show=!0,this.get_series(),this.save_series(),this.math_formula(),show_chart()}},methods:{get_list(){let rows=document.getElementById(this.selected.id).rows;for(let i=1;i<rows.length;i++){let value1=Number(rows[i].cells[1].innerText),value2=Number(rows[i].cells[2].innerText),value=[];value.push(value1,value2),this.selected.x.push(value1),this.selected.y.push(value2),this.selected.standard_series[i-1]=value}myStorage.setItem(this.selected.name,this.selected.standard_series)},get_series(){let series_data=myStorage.getItem(this.selected.name);if(series_data){series_data=(series_data=series_data.split(",")).map(Number);let new_data=[],x=[];for(let i=0;i<series_data.length/2;i++)x[i]=series_data.slice(2*i,2*i+2),new_data.push(x[i]);this.selected.standard_series=new_data}else this.selected.standard_series=this.selected.items},save_series(){this.selected.x=[],this.selected.y=[];let rows=this.selected.standard_series;for(let i=0;i<rows.length;i++)this.selected.x[i]=rows[i][0],this.selected.y[i]=rows[i][1]},cal_b(){this.selected.b=0;let n=this.selected.x.length,x_=[];for(let i=0;i<n;i++)x_.push(this.selected.x[i]*this.selected.x[i]);let over=this.sum(this.selected.y,this.selected.x)-n*this.average(this.selected.x)*this.average(this.selected.y),under=this.sum_1(x_)-n*(this.average(this.selected.x)*this.average(this.selected.x));this.selected.b=(over/under).toFixed(4)},cal_a(){this.selected.a=1,this.selected.a=(this.average(this.selected.y)-this.selected.b*this.average(this.selected.x)).toFixed(4)},cal_r(){this.selected.r=1;let n=this.selected.x.length,over=this.sum(this.selected.y,this.selected.x)-n*this.average(this.selected.x)*this.average(this.selected.y),under=Math.sqrt((this.sum(this.selected.x,this.selected.x)-n*this.average(this.selected.x)*this.average(this.selected.x))*(this.sum(this.selected.y,this.selected.y)-n*this.average(this.selected.y)*this.average(this.selected.y)));this.selected.r=(over/under).toFixed(4)},math_formula(){if(this.cal_b(),this.cal_a(),this.cal_r(),this.selected.formula="",this.selected.a>=0)this.selected.formula="<p>回归方程为：y = "+this.selected.b+"x + "+this.selected.a+"</p><p>相关系数为：r = "+this.selected.r+"</p>";else{let a=-this.selected.a;this.selected.formula="<p>回归方程为：y = "+this.selected.b+"x - "+a+"</p><p>相关系数为：r = "+this.selected.r+"</p>"}},add_item(){this.selected.standard_series.push(this.new_item)},del(index){this.selected.standard_series.splice(index,1)},add_sample(){this.add=!this.add,this.mystorages(),useCount(this.selected.name)},submit_result(){this.selected.new_results.id=this.selected.start,this.selected.results.push(this.selected.new_results),this.selected.new_results={id:this.selected.start,v:this.selected.v,a:"",m:"",result:""},this.selected.start=Number(this.selected.start)+1},del_sample(index){this.selected.results.splice(index,1)},sum(arr1,arr2){let result=0;for(let i=0;i<arr1.length;i++)result+=arr1[i]*arr2[i];return result},sum_1(arr){let z=0;for(let i=0;i<arr.length;i++)z+=arr[i];return z},average(arr){let over;return this.sum_1(arr)/arr.length},get_id(index){return"YXCDC2018水第"+this.selected.results[index].id+"号"},get_m(element){let a=this.selected.results[element].a;return this.selected.results[element].m=((a-this.selected.a)/this.selected.b).toFixed(3),this.selected.results[element].m},get_result(element){let v=this.selected.results[element].v,m=this.selected.results[element].m;this.selected.results[element].c=(m/v).toFixed(2);let c=this.selected.results[element].c;return c>=this.selected.limit?this.selected.results[element].result=c:this.selected.results[element].result="<"+this.selected.limit,this.selected.results[element].result},save_results(){let rows=document.getElementById("result_table").rows,start_item=Number(rows[1].cells[0].innerText),end_item=Number(rows[rows.length-1].cells[0].innerText);for(let i=start_item;i<=end_item;i++){let p=this.selected.name+i+"报告结果",str=JSON.stringify(this.selected.results[i-start_item]);myStorage.setItem(p,str)}let n=this.selected.name+"end";myStorage.setItem(n,end_item+1)},mystorages(){this.selected.st=[];let n=this.selected.name+"end";if(myStorage.getItem(n)){let keys=this.get_key();for(let i=0;i<keys.length;i++){let x=this.selected.name+keys[i]+"报告结果",p=myStorage.getItem(x);p=eval(JSON.parse(p)),this.selected.st.push(p)}this.selected.start=Number(myStorage.getItem(n))}else this.selected.start=this.selected.start;this.selected.judge?this.selected.end=this.selected.start:this.selected.end=1,this.selected.st.sort(function(i,j){return Number(i.id)>Number(j.id)?1:-1})},get_key(){let keys=[];var n=localStorage.length;for(let i=0;i<n;i++){let k=localStorage.key(i);if(-1!=k.search(this.selected.name)&&-1!=k.search("报告结果")){let number=k.replace(/^[^\d]*(\d+)[^\d]*$/,"$1");keys.push(number)}}return(keys=keys.map(Number)).sort(function(i,j){return i>j?1:-1}),keys}}}),series_data=[];function getTableContent(){series_data=app.selected.standard_series,myStorage.setItem(app.selected.name,series_data)}function focus_move(){window.scrollTo(0,document.documentElement.clientHeight)}function show_chart(){getTableContent(app.selected.id),chart=Highcharts.chart("line",{title:{text:"标准回归曲线"},subtitle:{text:app.selected.name},xAxis:{title:{text:"加样量(ml)"}},yAxis:{title:{text:"吸光度"}},legend:{layout:"vertical",align:"right",verticalAlign:"middle"},plotOptions:{series:{label:{connectorAllowed:!0},pointStart:0}},series:[{name:"吸光度",data:series_data}],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}}]}})}function useCount(item){let pagecount=item+"pagecount",judge=item+"judge";myStorage.getItem(pagecount)?myStorage.setItem(pagecount,Number(myStorage.getItem(pagecount))+1):myStorage.setItem(pagecount,1),myStorage.getItem(judge)?(app.selected.judge=!0,myStorage.setItem(judge,!0)):(app.selected.judge=!1,myStorage.setItem(judge,!1))}